# AI-Tunnel v2 è®¾è®¡æ–‡æ¡£

> ä»å¼€å‘è€…å·¥å…· â†’ è½»é‡ API ç½‘å…³ï¼Œç®€æ´åˆ‡æ¢é¢æ¿ + å¤šç«™ç‚¹å†—ä½™ + æ™ºèƒ½è·¯ç”±

---

## ä¸€ã€ç°çŠ¶ï¼ˆv1ï¼‰

### å·²æœ‰åŠŸèƒ½
- SSH åå‘éš§é“ï¼Œæœ¬åœ°ç”µè„‘ä¸­è½¬ API è¯·æ±‚ç»•è¿‡ CF æ‹¦æˆª
- å¤šç«™ç‚¹åä»£ï¼Œæ¯ç«™ç‹¬ç«‹ç«¯å£
- SSE æµå¼å“åº”æ”¯æŒ
- è‡ªåŠ¨é‡è¿ã€ä¼˜é›…å…³é—­ã€å½©è‰²æ—¥å¿—

### ç—›ç‚¹
- æ²¡æœ‰å¯è§†åŒ–ï¼Œå…¨é ç»ˆç«¯
- å• Key å•é€šé“ï¼ŒæŒ‚äº†å°±æŒ‚äº†
- ç«™ç‚¹/Key å˜æ›´éœ€è¦æ”¹é…ç½®é‡å¯
- æ— æ³•æ„ŸçŸ¥ç«™ç‚¹å¥åº·çŠ¶æ€

---

## äºŒã€v2 ç›®æ ‡

**ä¸€å¥è¯ï¼š** è®© VPS ä¸Šçš„ AI åº”ç”¨ç¨³å®šã€å¯é åœ°è°ƒç”¨å¤šä¸ªç¬¬ä¸‰æ–¹ APIï¼Œé€šè¿‡ç®€æ´çš„åˆ‡æ¢é¢æ¿ç®¡ç†ä¸€åˆ‡ã€‚

### æ ¸å¿ƒåŸåˆ™
1. **è½»é‡** â€” å•è¿›ç¨‹ï¼Œé›¶æ„å»ºï¼Œæœ€å°‘ä¾èµ–
2. **ç®€æ´** â€” CC-Switch é£æ ¼ï¼Œä¸€çœ‹å°±æ‡‚ï¼Œä¸€é”®åˆ‡æ¢
3. **å¯é ** â€” å¤šç«™å†—ä½™ï¼Œè‡ªåŠ¨åˆ‡æ¢ï¼Œä¸æ€•å•ç‚¹æ•…éšœ

---

## ä¸‰ã€åŠŸèƒ½è®¾è®¡

### 3.1 å¤šç«™ç‚¹å†—ä½™ + æ•…éšœè½¬ç§»

**æ¦‚å¿µï¼š** ç›¸åŒæ¨¡å‹å¯é…ç½®å¤šä¸ª API ç«™ç‚¹ï¼Œç»„æˆ"é€šé“ç»„"ã€‚

```yaml
# v2 é…ç½®æ ¼å¼
channels:
  - name: "gpt4-primary"
    target: "https://hotaruapi.com"
    keys:
      - "sk-aaa"
      - "sk-bbb"
    weight: 10          # æƒé‡ï¼Œè¶Šé«˜è¶Šä¼˜å…ˆ
    maxRetries: 2

  - name: "gpt4-backup"
    target: "https://backup-api.com"
    keys:
      - "sk-ccc"
    weight: 5
    fallback: true      # æ ‡è®°ä¸ºå¤‡ç”¨

routeGroups:
  - name: "openai-compatible"
    path: "/v1/**"
    channels: ["gpt4-primary", "gpt4-backup"]
    strategy: "priority"  # priority | round-robin | lowest-latency
```

**è·¯ç”±ç­–ç•¥ï¼š**
| ç­–ç•¥ | è¯´æ˜ |
|------|------|
| `priority` | æŒ‰æƒé‡æ’åºï¼Œé«˜ä¼˜å…ˆã€‚æ•…éšœæ—¶é™çº§åˆ°ä¸‹ä¸€ä¸ª |
| `round-robin` | è½®è¯¢ï¼Œå‡è¡¡åˆ†é… |
| `lowest-latency` | é€‰æœ€è¿‘ä¸€æ¬¡å»¶è¿Ÿæœ€ä½çš„ |

**æ•…éšœè½¬ç§»æµç¨‹ï¼š**
```
è¯·æ±‚è¿›æ¥ â†’ channel A
  â†“ è¶…æ—¶/5xx/CFæ‹¦æˆªï¼Ÿ
è‡ªåŠ¨åˆ‡åˆ° channel B
  â†“ ä¹Ÿå¤±è´¥ï¼Ÿ
è¿”å›é”™è¯¯ + é€šçŸ¥ç”¨æˆ·
```

### 3.2 API Key æ±  + è½®æ¢

æ¯ä¸ª channel å¯é…å¤šä¸ª Keyï¼š
- **è½®è¯¢æ¨¡å¼** â€” æŒ‰é¡ºåºè½®æ¢ï¼Œå‡è¡¡æ¶ˆè€—
- **å¤±è´¥è·³è¿‡** â€” Key è¿”å› 401/403 è‡ªåŠ¨è·³åˆ°ä¸‹ä¸€ä¸ª
- **ä½™é¢æ„ŸçŸ¥**ï¼ˆP2ï¼‰â€” å®šæœŸæ£€æŸ¥ä½™é¢ï¼Œä½äºé˜ˆå€¼å‘Šè­¦

```yaml
channels:
  - name: "hotaru"
    target: "https://hotaruapi.com"
    keys:
      - "sk-key1"
      - "sk-key2"
      - "sk-key3"
    keyStrategy: "round-robin"   # round-robin | random
```

### 3.3 æ™ºèƒ½é‡è¯•

```yaml
settings:
  retry:
    maxRetries: 3
    retryOn: [429, 502, 503, 504]   # è¿™äº›çŠ¶æ€ç è§¦å‘é‡è¯•
    backoff: "exponential"           # fixed | exponential
    baseDelayMs: 1000
    maxDelayMs: 10000
```

- 429ï¼ˆé™æµï¼‰â†’ ç­‰å¾… + æ¢ Key é‡è¯•
- 502/503/504 â†’ æ¢ channel é‡è¯•
- CF 403ï¼ˆJS challengeï¼‰â†’ æ ‡è®° channel ä¸å¯ç”¨ï¼Œåˆ‡æ¢

### 3.4 é…ç½®çƒ­é‡è½½

- ç›‘å¬ `tunnel.config.yaml` æ–‡ä»¶å˜åŒ–ï¼ˆ`fs.watch`ï¼‰
- å˜åŒ–æ—¶é‡æ–°åŠ è½½ï¼Œä¸ä¸­æ–­ç°æœ‰è¿æ¥
- æ–°å¢ç«™ç‚¹ï¼šå¯åŠ¨æ–° proxy + tunnel
- åˆ é™¤ç«™ç‚¹ï¼šä¼˜é›…å…³é—­å¯¹åº” proxy + tunnel
- ä¿®æ”¹ Keyï¼šç«‹å³ç”Ÿæ•ˆï¼Œä¸‹æ¬¡è¯·æ±‚ä½¿ç”¨æ–° Key

### 3.5 å¥åº·æ£€æŸ¥

```yaml
channels:
  - name: "hotaru"
    target: "https://hotaruapi.com"
    healthCheck:
      path: "/v1/models"
      intervalMs: 60000
      timeoutMs: 5000
```

- å®šæœŸ HEAD/GET å¥åº·æ£€æŸ¥ç«¯ç‚¹
- è®°å½•å»¶è¿Ÿã€æˆåŠŸç‡
- è¿ç»­å¤±è´¥ N æ¬¡ â†’ æ ‡è®°ä¸º `unhealthy`ï¼Œè·¯ç”±ç»•å¼€
- æ¢å¤åè‡ªåŠ¨æ ‡è®°ä¸º `healthy`

### 3.6 ç®€æ˜“ Web UIï¼ˆCC-Switch é£æ ¼ï¼‰

**è®¾è®¡ç†å¿µï¼š** åƒç½‘ç»œä»£ç†åˆ‡æ¢å™¨ä¸€æ ·ç®€æ´ã€‚ä¸€é¡µæå®šï¼Œä¸æå¤šé¡µé¢è·¯ç”±ã€‚

#### ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš‡ AI-Tunnel                          [âš™ï¸] [ğŸ“Š] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŸ¢ hotaru   â”‚  â”‚ ğŸ”´ backup   â”‚  â”‚ â• æ·»åŠ   â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ å»¶è¿Ÿ: 180ms â”‚  â”‚ ç¦»çº¿        â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ æˆåŠŸ: 99.2% â”‚  â”‚ æˆåŠŸ: --    â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ è°ƒç”¨: 1,234 â”‚  â”‚ è°ƒç”¨: 0     â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ Keys: 3/3 âœ…â”‚  â”‚ Keys: 1/1 âŒâ”‚  â”‚          â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ [ğŸ”„ åˆ‡æ¢]   â”‚  â”‚ [ğŸ”„ åˆ‡æ¢]   â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ [â¸ æš‚åœ]   â”‚  â”‚ [â–¶ï¸ å¯ç”¨]   â”‚  â”‚          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ å®æ—¶æ—¥å¿—                                      â”‚
â”‚  13:49:01 âœ… hotaru  POST /v1/chat â†’ 200 (1.2s) â”‚
â”‚  13:49:03 âœ… hotaru  POST /v1/chat â†’ 200 (0.8s) â”‚
â”‚  13:49:05 âš ï¸ backup  POST /v1/chat â†’ 403 (0.1s) â”‚
â”‚  13:49:05 ğŸ”„ retry â†’ hotaru                      â”‚
â”‚  13:49:06 âœ… hotaru  POST /v1/chat â†’ 200 (1.1s) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯å®ç°

| ç»„ä»¶ | æ–¹æ¡ˆ | ç†ç”± |
|------|------|------|
| å‰ç«¯æ¡†æ¶ | **htmx** + **Tailwind CDN** | é›¶æ„å»ºï¼Œå• HTML æ–‡ä»¶ |
| å®æ—¶æ›´æ–° | **SSE** (Server-Sent Events) | æ—¥å¿— + çŠ¶æ€æ¨é€ï¼Œæ¯” WebSocket ç®€å• |
| åç«¯ | å†…åµŒåœ¨ä¸»è¿›ç¨‹ï¼ŒåŸç”Ÿ http | ä¸é¢å¤–å¼•ä¾èµ– |
| æ ·å¼ | æš—è‰²ä¸»é¢˜ï¼Œåœ†è§’å¡ç‰‡ | å¼€å‘è€…å‹å¥½ |

#### åç«¯ API

```
GET  /api/status              # å…¨å±€çŠ¶æ€
GET  /api/channels             # æ‰€æœ‰ channel åˆ—è¡¨ + çŠ¶æ€
POST /api/channels/:name/toggle  # å¯ç”¨/ç¦ç”¨
POST /api/channels/:name/switch  # è®¾ä¸ºä¸»ç”¨
POST /api/channels/:name/keys    # æ·»åŠ  Key
DELETE /api/channels/:name/keys/:index  # åˆ é™¤ Key
GET  /api/logs                 # æœ€è¿‘æ—¥å¿—ï¼ˆSSE æµï¼‰
GET  /api/stats                # ç»Ÿè®¡æ•°æ®
POST /api/config/reload        # æ‰‹åŠ¨é‡è½½é…ç½®
GET  /                         # Web UIï¼ˆå• HTMLï¼‰
```

---

## å››ã€æ¶æ„ï¼ˆv2ï¼‰

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    Web UI (:3000)     â”‚
                          â”‚  htmx + Tailwind      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ HTTP API + SSE
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    API Server         â”‚
                          â”‚  çŠ¶æ€/æ§åˆ¶/æ—¥å¿—        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Router Engine                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è·¯ç”±ç­–ç•¥     â”‚  â”‚ Key è½®æ¢      â”‚  â”‚ é‡è¯• + æ•…éšœè½¬ç§»        â”‚  â”‚
â”‚  â”‚ priority    â”‚  â”‚ round-robin  â”‚  â”‚ exponential backoff   â”‚  â”‚
â”‚  â”‚ round-robin â”‚  â”‚ skip-failed  â”‚  â”‚ channel failover      â”‚  â”‚
â”‚  â”‚ low-latency â”‚  â”‚              â”‚  â”‚                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚       Channel Pool          â”‚
              â”‚                             â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”‚
              â”‚  â”‚ ch-A â”‚  â”‚ ch-B â”‚  â”‚...â”‚  â”‚
              â”‚  â”‚ 3keysâ”‚  â”‚ 1key â”‚  â”‚   â”‚  â”‚
              â”‚  â”‚ ğŸŸ¢   â”‚  â”‚ ğŸ”´   â”‚  â”‚   â”‚  â”‚
              â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â”‚
              â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ SSH Tunnel  â”‚  â”‚ SSH Tunnel  â”‚
         â”‚ (å¯é€‰)      â”‚  â”‚ (å¯é€‰)      â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ hotaru API  â”‚  â”‚ backup API  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿›ç¨‹æ¨¡å‹
- **å•è¿›ç¨‹**ï¼Œæ‰€æœ‰ç»„ä»¶è·‘åœ¨ä¸€èµ·
- Web UI ç«¯å£é»˜è®¤ `:3000`ï¼ˆå¯é…ç½®ï¼‰
- å¯¹å¤–ç»Ÿä¸€å…¥å£ç«¯å£ `:9000`ï¼ˆVPS ä¸Šçš„åº”ç”¨è¿è¿™ä¸ªï¼‰
- Router æ ¹æ®è¯·æ±‚è·¯å¾„ + ç­–ç•¥åˆ†å‘åˆ°å…·ä½“ channel

### ç»Ÿä¸€å…¥å£ vs å¤šç«¯å£

**v1ï¼ˆå¤šç«¯å£ï¼‰ï¼š** æ¯ä¸ªç«™ç‚¹ä¸€ä¸ªç«¯å£ï¼ˆ9090, 9091, ...ï¼‰ï¼Œåº”ç”¨è¦æ”¹ baseURL

**v2ï¼ˆç»Ÿä¸€å…¥å£ï¼‰ï¼š** ä¸€ä¸ªç«¯å£ `:9000`ï¼Œå†…éƒ¨è·¯ç”±
- åº”ç”¨åªéœ€é…ä¸€ä¸ªåœ°å€ï¼š`http://localhost:9000`
- Router è´Ÿè´£é€‰ channelã€é€‰ Keyã€é‡è¯•
- å¯¹ä¸Šå±‚å®Œå…¨é€æ˜

---

## äº”ã€é…ç½®æ–‡ä»¶ï¼ˆv2 å®Œæ•´ï¼‰

```yaml
# tunnel.config.yaml (v2)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æœåŠ¡é…ç½®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
server:
  # ç»Ÿä¸€å…¥å£ç«¯å£ï¼ˆVPS ä¸Šçš„åº”ç”¨è¿è¿™é‡Œï¼‰
  port: 9000
  host: "127.0.0.1"

  # Web UI
  ui:
    enabled: true
    port: 3000
    host: "127.0.0.1"    # å®‰å…¨ï¼šåªç›‘å¬æœ¬åœ°

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SSH è¿æ¥ï¼ˆå¯é€‰ï¼Œä¸ç”¨éš§é“æ—¶å¯åˆ é™¤ï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ssh:
  host: "YOUR_VPS_IP"
  port: 22
  username: "root"
  privateKeyPath: "~/.ssh/id_rsa"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# API é€šé“é…ç½®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
channels:
  - name: "hotaru"
    target: "https://hotaruapi.com"
    keys:
      - "sk-key-1"
      - "sk-key-2"
    keyStrategy: "round-robin"
    weight: 10
    tunnel:                       # å¯é€‰ï¼šæ˜¯å¦èµ° SSH éš§é“
      enabled: true
      localPort: 8080
      remotePort: 9090
    healthCheck:
      path: "/v1/models"
      intervalMs: 60000
      timeoutMs: 5000

  - name: "backup-api"
    target: "https://backup-api.com"
    keys:
      - "sk-backup-1"
    weight: 5
    fallback: true
    tunnel:
      enabled: true
      localPort: 8081
      remotePort: 9091

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è·¯ç”±ç»„
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
routes:
  - path: "/v1/**"
    channels: ["hotaru", "backup-api"]
    strategy: "priority"          # priority | round-robin | lowest-latency

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å…¨å±€è®¾ç½®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
settings:
  retry:
    maxRetries: 3
    retryOn: [429, 502, 503, 504]
    backoff: "exponential"
    baseDelayMs: 1000
    maxDelayMs: 10000
  reconnectInterval: 5000
  logLevel: "info"
  hotReload: true                 # é…ç½®æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡è½½

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
notifications:
  telegram:
    enabled: false
    botToken: ""
    chatId: ""
    events: ["channel_down", "all_channels_down", "key_exhausted"]
```

---

## å…­ã€æ–°å¢ä¾èµ–

| åŒ… | ç”¨é€” | å¤§å° |
|------|------|------|
| æ— æ–°å¢ | htmx/tailwind èµ° CDN | 0 |

**åŸåˆ™ï¼šä¸æ–°å¢ npm ä¾èµ–ã€‚** å‰ç«¯å…¨èµ° CDNï¼Œåç«¯ç”¨åŸç”Ÿ Node.js http æ¨¡å—ã€‚

---

## ä¸ƒã€æ–‡ä»¶ç»“æ„ï¼ˆv2ï¼‰

```
ai-tunnel/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.mjs          # ä¸»å…¥å£
â”‚   â”œâ”€â”€ cli.mjs            # CLI
â”‚   â”œâ”€â”€ config.mjs         # é…ç½®åŠ è½½ + çƒ­é‡è½½
â”‚   â”œâ”€â”€ router.mjs         # ğŸ†• è·¯ç”±å¼•æ“ï¼ˆç­–ç•¥ã€æ•…éšœè½¬ç§»ï¼‰
â”‚   â”œâ”€â”€ channel.mjs        # ğŸ†• Channel ç®¡ç†ï¼ˆKey æ± ã€å¥åº·çŠ¶æ€ï¼‰
â”‚   â”œâ”€â”€ proxy.mjs          # åå‘ä»£ç†ï¼ˆæ”¹é€ ï¼šæ¥å…¥ routerï¼‰
â”‚   â”œâ”€â”€ tunnel.mjs         # SSH éš§é“
â”‚   â”œâ”€â”€ retry.mjs          # ğŸ†• é‡è¯•é€»è¾‘
â”‚   â”œâ”€â”€ health.mjs         # ğŸ†• å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ api.mjs            # ğŸ†• Web API å±‚
â”‚   â”œâ”€â”€ logger.mjs         # æ—¥å¿—ï¼ˆå¢å¼ºï¼šäº‹ä»¶æ€»çº¿ï¼‰
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ index.html     # ğŸ†• Web UI å•é¡µé¢
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ V2_DESIGN.md       # æœ¬æ–‡æ¡£
â”œâ”€â”€ tunnel.config.example.yaml
â”œâ”€â”€ package.json
â”œâ”€â”€ AGENTS.md
â””â”€â”€ README.md
```

---

## å…«ã€å¼€å‘è·¯çº¿

### Phase 1 â€” æ ¸å¿ƒå¼•æ“ï¼ˆ1-2 å¤©ï¼‰
- [ ] `channel.mjs` â€” Channel å¯¹è±¡ï¼Œç®¡ç† Key æ± ã€å¥åº·çŠ¶æ€
- [ ] `router.mjs` â€” è·¯ç”±å¼•æ“ï¼Œç­–ç•¥é€‰æ‹©ã€æ•…éšœè½¬ç§»
- [ ] `retry.mjs` â€” é‡è¯•é€»è¾‘ï¼ŒæŒ‡æ•°é€€é¿
- [ ] æ”¹é€  `proxy.mjs` â€” ç»Ÿä¸€å…¥å£ï¼Œæ¥å…¥ router
- [ ] æ”¹é€  `config.mjs` â€” æ”¯æŒ v2 é…ç½®æ ¼å¼ + çƒ­é‡è½½

### Phase 2 â€” å¯è§‚æµ‹æ€§ï¼ˆ1 å¤©ï¼‰
- [ ] `health.mjs` â€” å®šæœŸå¥åº·æ£€æŸ¥
- [ ] `logger.mjs` å¢å¼º â€” äº‹ä»¶æ€»çº¿ï¼Œä¾› UI è®¢é˜…
- [ ] `api.mjs` â€” REST API + SSE æ¨é€

### Phase 3 â€” Web UIï¼ˆ1 å¤©ï¼‰
- [ ] `ui/index.html` â€” åˆ‡æ¢é¢æ¿ï¼Œhtmx + Tailwind
- [ ] å¡ç‰‡çŠ¶æ€ã€ä¸€é”®åˆ‡æ¢ã€å®æ—¶æ—¥å¿—
- [ ] æš—è‰²ä¸»é¢˜

### Phase 4 â€” æ”¶å°¾
- [ ] æ›´æ–° README
- [ ] æ›´æ–° AGENTS.md
- [ ] æµ‹è¯• + ä¿® bug
- [ ] npm publish å‡†å¤‡

---

## ä¹ã€å‘åå…¼å®¹

- v1 çš„é…ç½®æ ¼å¼ï¼ˆ`sites` å­—æ®µï¼‰ä»ç„¶æ”¯æŒï¼Œè‡ªåŠ¨è½¬æ¢ä¸º v2 æ ¼å¼
- åŸæ¥çš„å¤šç«¯å£æ¨¡å¼ä¿ç•™ä¸º `legacy` æ¨¡å¼
- ç»Ÿä¸€å…¥å£ä¸ºé»˜è®¤æ¨¡å¼

---

## åã€å¯¹æ¯”

| ç‰¹æ€§ | v1 | v2 |
|------|-----|-----|
| ç«™ç‚¹ç®¡ç† | æ”¹ yaml é‡å¯ | Web UI + çƒ­é‡è½½ |
| æ•…éšœå¤„ç† | æ‰‹åŠ¨åˆ‡ | è‡ªåŠ¨è½¬ç§» |
| Key ç®¡ç† | å†™åœ¨ headers é‡Œ | Key æ± è½®æ¢ |
| å…¥å£ | å¤šç«¯å£ | ç»Ÿä¸€ç«¯å£ |
| ç›‘æ§ | çœ‹ç»ˆç«¯æ—¥å¿— | åˆ‡æ¢é¢æ¿ + çŠ¶æ€ç¯ |
| é‡è¯• | æ—  | æ™ºèƒ½é‡è¯• + é€€é¿ |
