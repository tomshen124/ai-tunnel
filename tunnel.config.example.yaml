# tunnel.config.yaml - AI-Tunnel v2 配置文件
# 复制此文件为 tunnel.config.yaml 并修改

# ═══════════════════════════════════════
# 服务配置
# ═══════════════════════════════════════
server:
  # 统一代理端口（本地和 VPS 的请求都走这里）
  port: 9000
  host: "127.0.0.1"

  # Web UI
  ui:
    enabled: true
    port: 3000
    host: "127.0.0.1"
    # 可选：保护 Web UI / API（Bearer Token）
    # 开启后访问需带 Header：Authorization: Bearer <token>
    # 注意：SSE(/api/logs) 用 EventSource 无法带 header，UI 会自动使用 ?token=...
    # token: "change-me"

# ═══════════════════════════════════════
# SSH 反向隧道（可选，不用隧道时删除此段）
#
# 工作原理:
#   VPS 上的应用 → VPS:remotePort → SSH 反向隧道 → 本地 proxy:9000 → 直连 API
#   本地 Mac/PC 用住宅 IP 访问 API，绕过 CF 对 VPS IP 的封锁
# ═══════════════════════════════════════
ssh:
  host: "YOUR_VPS_IP"
  port: 22
  username: "root"
  # 认证方式（二选一）
  privateKeyPath: "~/.ssh/id_rsa"
  # password: "your-password"

# ═══════════════════════════════════════
# API 通道配置
# ═══════════════════════════════════════
channels:
  - name: "hotaru"
    target: "https://hotaruapi.com"
    keys:
      - "sk-your-key-1"
      - "sk-your-key-2"
    keyStrategy: "round-robin"     # round-robin | random
    weight: 10                     # 权重越高优先级越高
    tunnel:
      enabled: true                # 在 VPS 上开反向隧道入口
      remotePort: 9090             # VPS 上监听的端口（应用连这个）
    healthCheck:
      path: "/v1/models"
      intervalMs: 60000
      timeoutMs: 5000

  - name: "backup-api"
    target: "https://another-api.com"
    keys:
      - "sk-backup-key"
    weight: 5
    fallback: true                 # 备用通道
    tunnel:
      enabled: true
      remotePort: 9091

# ═══════════════════════════════════════
# 路由组（可选，默认全部 channel 走 priority）
# ═══════════════════════════════════════
routes:
  - path: "/v1/**"
    channels: ["hotaru", "backup-api"]
    strategy: "priority"           # priority | round-robin | lowest-latency

# ═══════════════════════════════════════
# 全局设置
# ═══════════════════════════════════════
settings:
  reconnectInterval: 5000
  logLevel: "info"                 # debug | info | warn | error
  hotReload: true                  # 配置变更自动重载

  retry:
    maxRetries: 3
    retryOn: [429, 502, 503, 504]
    backoff: "exponential"         # exponential | fixed
    baseDelayMs: 1000
    maxDelayMs: 10000
